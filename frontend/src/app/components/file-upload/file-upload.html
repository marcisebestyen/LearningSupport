<div class="upload-layout">
  <h2>Upload Document</h2>

  @if (!selectedFile()) {
    <div class="drop-zone" appDragDrop (fileDropped)="onFileDropped($event)">
      <div class="icon">‚òÅÔ∏è</div>
      <h3>Drag & Drop File</h3>
      <p>PDF, Word (.docx) or PowerPoint (.pptx)</p>

      <label for="fileInput" class="browse-btn">Browse Computer</label>
      <input
        type="file"
        id="fileInput"
        (change)="onFileSelected($event)"
        accept=".pdf, .docx, .pptx"
        hidden
      >
    </div>
  }

  @if (selectedFile()) {
    <div class="file-card">
      <div class="card-header">
        <span>üìÑ</span>
        <span>Review Selection</span>
      </div>

      <div class="card-body">

        <div class="file-details">
          <div class="detail-item">
            <label>Filename</label>
            <span>{{ fileName() }}</span>
          </div>
          <div class="detail-item">
            <label>Size</label>
            <span>{{ fileSize() }}</span>
          </div>
        </div>

        <hr class="divider">

        <div class="input-section">
          <label>üéØ Study Focus (Optional)</label>
          <p class="helper-text">
            Uploading a whole book? Tell the AI which chapter or topic to summarize.
            <br><em>(Leave empty to summarize the entire document)</em>
          </p>
          <div class="input-group">
            <input
              type="text"
              [ngModel]="studyFocus()"
              (ngModelChange)="studyFocus.set($event)"
              placeholder="e.g. 'Chapter 4: The Cold War' or 'Only organic chemistry sections'"
            >
          </div>
        </div>

        <div class="category-section">
          <label>Category (Optional)</label>

          @if (!isAddingNewCategory()) {
            <div class="input-group">
              <select [ngModel]="selectedCategory()" (ngModelChange)="selectedCategory.set($event)">
                <option value="">-- Select Category --</option>
                @for (cat of existingCategories(); track cat) {
                  <option [value]="cat">{{ cat }}</option>
                }
              </select>
              <button class="toggle-btn" (click)="toggleNewCategory()">+ New</button>
            </div>
          } @else {
            <div class="input-group">
              <input type="text" placeholder="Type category name..."
                     [ngModel]="newCategoryInput()" (ngModelChange)="newCategoryInput.set($event)">
              <button class="toggle-btn" (click)="toggleNewCategory()">Cancel</button>
            </div>
          }
        </div>

        <div class="actions">
          <button class="secondary-btn" (click)="selectedFile.set(null)" [disabled]="isLoading()">
            Cancel
          </button>

          <button class="primary-btn" (click)="startUpload()" [disabled]="isLoading()">
            {{ isLoading() ? 'Uploading...' : 'Confirm Upload üöÄ' }}
          </button>
        </div>

      </div>
    </div>
  }

</div>
