<div class="history-layout">

  <div class="history-list">
    <h3>Previous Uploads</h3>

    <div class="filter-container">
      <label>Filter by Category:</label>
      <select [(ngModel)]="selectedFilter">
        <option value="ALL">Show All</option>
        @for (cat of categories(); track cat) {
          <option [value]="cat">{{ cat }}</option>
        }
      </select>
    </div>

    @if (history().length === 0) {
      <p class="empty-msg">No documents found.</p>
    }

    @for (item of filteredHistory(); track item.id) {
      <div
        class="history-item"
        [class.selected]="selectedDocId() === item.id"
        (click)="selectDoc(item)">
        <div class="doc-icon">ğŸ“„</div>
        <div class="doc-info">
          <span class="filename">{{ item.filename }}</span>
          <span class="date">{{ item.upload_date | date:'shortDate' }}</span>
        </div>
        <button class="delete-btn" (click)="deleteDoc($event, item)" title="Delete">ğŸ—‘ï¸</button>
      </div>
    }
  </div>

  <div class="history-content">
    @if (selectedSummary()) {
      <div class="summary-card">
        <h2>Summary: {{ selectedFilename() }}</h2>
        <div class="markdown-body">
          <markdown [data]="selectedSummary()"></markdown>
        </div>
        <div class="action-bar">
          <button class="quiz-btn" (click)="generateQuiz()" [disabled]="isGeneratingQuiz()">
            @if (isGeneratingQuiz()) {
              <div class="spinner"></div>
              Generating...
            } @else {
              âœ¨ Generate Quiz
            }
          </button>
        </div>
      </div>
    } @else {
      <div class="placeholder">
        <span class="icon">ğŸ‘ˆ</span>
        <p>Select a document from the list to view its summary.</p>
      </div>
    }
  </div>
</div>
